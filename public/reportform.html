<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>StreetWise | Submit a Report </title>
    <!-- CSS  -->
    <link rel="stylesheet" href="https://cdn.rawgit.com/konpa/devicon/df6431e323547add1b4cf45992913f15286456d3/devicon.min.css">
    <link rel="stylesheet" type="text/css" href="./style/css/reset.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.1/css/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="./style/css/styleC.css">
    <!-- google fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link href="https://use.fontawesome.com/fefb8214e6.css" media="all" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Anonymous+Pro|Asap+Condensed|Inconsolata|Nunito+Sans:300i|Rasa|Special+Elite" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="./style/images/icon.png">
</head>

<body>
    <nav class="cyan darken-1" role="navigation">
        <div class="nav-wrapper container"><img src="./style/images/colors400.png" alt="private-eye logo" id="logo"><a id="logo-container" href="index.html" class="brand-logo">StreetWise</a>
            <ul class="right hide-on-med-and-down">
                <li class="homePage"><a href="/"><i class="material-icons">home</i></a></li>
                <li class="reportPage"><a href="/reportincident"><i class="material-icons">report</i></a></li>
                <li class="incidentPage"><a href="/viewincidents"><i class="material-icons">location_on</i></a></li>
            </ul>
            <a href="#" data-activates="mobile-demo" class="button-collapse"><i class="material-icons">menu</i></a>
        <!--     <ul class="right hide-on-med-and-down">
                <li><a href="/">Home</a></li>
                <li><a href="/reportIncident">Report Incident</a></li>
                <li><a href="/viewincidents">View Incidents</a></li>
            </ul> -->
            <ul class="side-nav" id="mobile-demo">
                 <li><a href="/">Home</a></li>
                <li><a href="/reportIncident">Report Incident</a></li>
                <li><a href="/viewincidents">View Incidents</a></li>
            </ul>
        </div>
    </nav>
    <div class="container">
        <h1 class="header center col s12 blue-grey-text">View. Report. Get StreetWise.</h1>
        <!--         <div class="col s6">
            <div id="formInstructions" class="row">
                <h4>Step 1:</h4>
                <br>
                <p>Search for the address where your incident occurred in the map search bar. Once you've found the incident location, click on the marker and the report form will appear with the location information and time autopopulated (these can be edited).</p>
                <br>
                <h4>Step 2: </h4>
                <p>Fill in the report form with as much detail as possible. The decription field is optional, but preferred so users will have the most information.</p>
                <br>
                <h4>Step 3:</h4>
                <p>Submit your report.</p>
                <h4>Step 4:</h4>
                <p>View your incident along with other incidents reported to StreetWise in reverse chronological order.</p>
            </div>
        </div> -->
        <!--  <div class="container aboutText"> -->
        <!--   Icon Section   -->
        <div class="row steps">
            <h5 class="header center col s12 black-text">Report your harassment in 3 easy steps and get the piece of mind you deserve.</h5>
            <div class="col s12 m4">
                <div class="icon-block">
                    <h5 class="center">Step 1:</h5>
                    <p class="light">Search for your incident location. If needed, drag and drop the marker to your location.</p>
                </div>
            </div>
            <div class="col s12 m4">
                <div class="icon-block">
                    <h5 class="center">Step 2:</h5>
                    <p class="light">Click on the marker to call the incident report form.</p>
                </div>
            </div>
            <div class="col s12 m4">
                <div class="icon-block">
                    <h5 class="center">Step 3:</h5>
                    <p class="light"> Submit your report and view your incident along with all others reported to StreetWise.</p>
                </div>
            </div>
     <!--        <div class="col s12 m3">
                <div class="icon-block">
                    <h5 class="center">Step 4:</h5>
                    <p class="light">Use "Report" button to submit the details of your harrassment. Then, view your incident along with other incidents reported to StreetWise in reverse chronological order.</p>
                </div>
            </div> -->
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col s12">
                <form class="hidden" class="col s12" method="POST" action="/postIncident">
                    <div class="row" id="formSpace">
                        <div class="col s12">
                            <div class="col s12">
                                <div class="input-field">
                                    <select name="HarassmentType" id="harassmentType">
                                        <option value="" disabled selected>Choose your option</option>
                                        <option value="Catcall">Catcalling</option>
                                        <option value="Indecent Exposure">Indecent Exposure</option>
                                        <option value="Sexual Assault">Sexual Assault</option>
                                        <option value="Touching/Groping">Touching/Groping</option>
                                        <option value="Stalking">Stalking</option>
                                        <option value="Whistling">Whistling</option>
                                        <option value="Racist Remarks">Racist Remarks</option>
                                        <option value="Other">Other</option>
                                    </select>
                                    <label>Harassment Types</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row longHidden">
                        <div class="col s12 ">
                            <div class="col s12">
                                <label for="longitude_input">Longitude:</label>
                                <input name="Longitude" id="longitude_input" type="text" class="validate">
                            </div>
                        </div>
                    </div>
                    <div class="row latHidden">
                        <div class="col s12">
                            <div class="col s12">
                                <label for="latitude_input">Latitude:</label>
                                <input name="Latitude" id="latitude_input" type="text" class="validate" disable selected>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col s12">
                            <div class="col s12">
                                <label for="address_input">Address:</label>
                                <input name="Address" id="address_input" type="text" class="validate" disable selected>
                            </div>
                        </div>
                    </div>
                    <div class="row>">
                        <div class="col s12">
                            <label for="dateTime_input">Date and Time:</label>
                            <input name="DateTime" id="dateTime_input" type="text" class="validate">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col s12">
                            <div class="row">
                                <div class="col s12">
                                    <div class="input-field col s12">
                                        <textarea name="Description" id="desc_input" class="materialize-textarea" class="validate"></textarea>
                                        <label for="desc_input">Description:</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div align="center">
                                <div class="col s12">
                                    <button id="submitForm" class="btn waves-effect waves-light blue-grey darken-1" type="submit" name="action">Report
                                        <i class="material-icons right">report</i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="col s6">
            <div id="map"></div>
            <input id="pac-input" />
            <div id="type-selector" class="controls"></div>
        </div>
    </div>
    </div>
    <footer class="page-footer cyan darken-1">
        <div class="container footer-area">
            <!-- contact -->
            <div class="row">
                <h5>Connect with StreetWise:</h5>
                <div class="col s12 contactArea">
                    <a href="#"><i class="contact-icons fa fa-envelope-o" aria-hidden="true"></i></a>
                    <a href="#"><i class="contact-icons fa fa-github" aria-hidden="true"></i></a>
                    <a href="#"><i class="contact-icons fa fa-twitter-square" aria-hidden="true"></i></a>
                    <a href="#"><i class="contact-icons fa fa-facebook-square" aria-hidden="true"></i></a>
                </div>
            </div>
        </div>
        <div class="footer-copyright">
            <div class="container center cyan-text text-darken-4">
                All rights reserved by StreetWise 2017
            </div>
        </div>
    </footer>
    <!--  Scripts-->
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="https://use.fontawesome.com/0dc977594a.js"></script>
    <!--  GOOGLE Scripts-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB0PrStRxe3h9hhyYl9V0bZ1vxNrKbpiOo&libraries=places&callback=initMap" async defer></script>
    <!--  Scripts-->
    <script src="https://use.fontawesome.com/fefb8214e6.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="https://use.fontawesome.com/fefb8214e6.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.1/js/materialize.min.js"></script>
    <!-- Moment.js Reference -->
    <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>
    <script type="text/javascript">
    $(".button-collapse").sideNav();
    //Code for form dropdown to work
    $(document).ready(function() {

    });

    $('select').material_select();

    $('#desc_input').val();
    $('#desc_input').trigger('autoresize');

    $('submitForm').click(function() {
        alert('Thank you for reporting your incident.');
    });

    //Variable for Date & Time that will appear in the form
    var dateTime = moment().format('MMMM Do YYYY, h:mm:ss a');

    function initMap() {
        var geocoder;
        var map;
        var marker;
        var map = new google.maps.Map(document.getElementById('map'), {
            center: {
                lat: 40.7282,
                lng: -74.0776417
            },
            zoom: 12
        });

        var input = /** @type {!HTMLInputElement} */ (
            document.getElementById('pac-input'));

        var types = document.getElementById('type-selector');
        map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);
        map.controls[google.maps.ControlPosition.TOP_LEFT].push(types);


        var autocomplete = new google.maps.places.Autocomplete(input);
        // console.log(input);
        autocomplete.bindTo('bounds', map);

        // This gives auto options similar to the input the user is typing the address 

        autocomplete.addListener('place_changed', function() {
            infowindow.close();
            marker.setVisible(false);
            var place = autocomplete.getPlace();
            if (!place.geometry) {
                window.alert("Autocomplete's returned place contains no geometry");
                return;
            }

            // If the place has a geometry, then present it on a map.
            if (place.geometry.viewport) {
                map.fitBounds(place.geometry.viewport);
            } else {
                map.setCenter(place.geometry.location);
                map.setZoom(17); // Why 17? Because it looks good.
            }

            marker.setPosition(place.geometry.location);
            marker.setVisible(true);
            marker.addListener('click', displayForm);

            // this lets the pin be the place the searcher is looking for

            // infowindow.setContent('<div><strong>' + place.name + '</strong><br>' + address);
            infowindow.open(map, marker);

        });

        var infowindow = new google.maps.InfoWindow();
        var marker = new google.maps.Marker({
            map: map,
            anchorPoint: new google.maps.Point(0, -29),
            draggable: true
        });

        function geocodePosition(pos) {
            geocoder = new google.maps.Geocoder();
            geocoder.geocode({
                latLng: pos
            }, function(responses) {
                if (responses && responses.length > 0) {
                    marker.formatted_address = responses[0].formatted_address;
                } else {
                    marker.formatted_address = 'Cannot determine address at this location.';
                }
                infowindow.setContent(marker.formatted_address + "<br>coordinates: " + marker.getPosition().toUrlValue(6));
                infowindow.open(map, marker);
                console.log("New Address: ", marker.formatted_address)
            });
        }
        google.maps.event.addListener(marker, 'dragend', function() {
            document.getElementsByName('latitude_input').value = marker.getPosition().lat();
            document.getElementsByName('longitude_input').value = marker.getPosition().lng();
            // updateMarkerStatus('Drag ended');
            geocodePosition(marker.getPosition());

            console.log("THE LONGITUDE IS:" + marker.getPosition().lng());
            console.log("THE LATITUDE IS:" + marker.getPosition().lat());

        });

        function displayForm() {

            var geocoder = new google.maps.Geocoder(); // create a geocoder object
            var location = new google.maps.LatLng(marker.getPosition().lat(), marker.getPosition().lng()); // turn coordinates into an object          
            geocoder.geocode({ 'latLng': location }, function(results, status) {
                if (status == google.maps.GeocoderStatus.OK) { // if geocode success
                    var add = results[0].formatted_address; // if address found, pass to processing function
                    // console.log(add);

                }

                $('form').css('display', 'block');
                console.log("marker clicked");
                $('#map').css('display', 'none');
                $("#longitude_input").val(marker.getPosition().lng());
                $("#latitude_input").val(marker.getPosition().lat());
                $("#address_input").val(add);
                $('#dateTime_input').val(dateTime);
                // console.log(currentLocation);
                // console.log(currentDate);
                // console.log(currentTime);
                // console.log(add);

            })

        }

    }

    // google.maps.event.addDomListener(window, "load", initMap);
    </script>
</body>

</html>